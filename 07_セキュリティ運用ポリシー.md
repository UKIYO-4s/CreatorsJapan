# セキュリティ運用ポリシー

## 保守プラン対応表

本ポリシーの各項目と保守プランの対応関係を示します。

| セクション | 項目 | 標準プラン | プレミアム | 備考 |
|------------|------|:----------:|:----------:|------|
| 1. アカウント管理 | 棚卸し（四半期） | ○ | ○ | |
| | 2FA導入支援 | ○ | ○ | 初回 + 随時 |
| | 権限見直し | ○ | ○ | 半年 |
| 2. 変更管理 | 更新作業フロー | ○ | ○ | |
| | 更新履歴記録 | ○ | ○ | |
| 3. 侵害検知 | 改ざん検知（自動） | - | ○ | 週1回ハッシュ比較 |
| | ログイン監視 | ○ | ○ | |
| 4. ログ保全 | 標準保管（90日） | ○ | - | |
| | 延長保管（180日） | - | ○ | |
| 5. WAF/CDN | 設定確認 | ○ | ○ | |
| | 詳細チューニング | - | オプション | 別途費用 |
| 6. プラグイン | 脆弱性ウォッチ | ○ | ○ | 週1回 |
| 7. コア/テーマ更新 | マイナー更新 | ○ | ○ | |
| | メジャー更新 | オプション | オプション | 別途費用 |
| 8. 重要ファイル保護 | 初期設定 | 初期構築 | 初期構築 | フェーズ3 |
| 9. インシデント対応 | 初動調査 | ○ | ○ | |
| | 復旧作業 | 別途 | 別途 | 時間制 |

**凡例**: ○=含む、-=含まない、オプション=別途費用

---

## 1. アカウント管理

### 管理者アカウント棚卸し

| 作業 | 頻度 | 内容 |
|------|------|------|
| アカウント一覧確認 | 四半期 | 全ユーザーの権限確認 |
| 不要アカウント削除 | 随時 | 退職者、使用停止アカウント |
| 権限見直し | 半年 | 最小権限の原則に基づく調整 |

### 権限最小化の原則

| 役割 | 推奨権限 | 備考 |
|------|----------|------|
| サイト所有者 | 管理者 | 1-2名に限定 |
| 運用担当 | 編集者 | 日常運用に必要な範囲 |
| コンテンツ担当 | 投稿者 | 記事投稿のみ |
| 外部委託 | 必要最小限 | 作業完了後は削除または降格 |

### 二要素認証（2FA）

| 対象 | 必須/推奨 | 方法 |
|------|-----------|------|
| 管理者権限 | **必須** | TOTP（Google Authenticator等） |
| 編集者権限 | 推奨 | TOTP |
| FTP/SSH | **必須** | 公開鍵認証 または IP制限 |
| サーバーパネル | **必須** | サービス提供の2FA |

### パスワードポリシー

- 最低12文字以上
- 英大文字・小文字・数字・記号を含む
- 他サービスとの使い回し禁止
- 90日ごとの変更を推奨

---

## 2. 変更管理

### 更新作業フロー

```
1. 事前確認
   └─ 更新内容の確認（チェンジログ確認）
   └─ 互換性の確認（PHP/WPバージョン）

2. バックアップ取得
   └─ データベース
   └─ 対象ファイル（プラグイン/テーマ/コア）

3. テスト環境で検証（重要な更新の場合）
   └─ 主要機能の動作確認
   └─ 表示崩れの確認

4. 本番適用
   └─ 低トラフィック時間帯を選択
   └─ 1件ずつ適用（一括更新しない）

5. 動作確認
   └─ フロント表示確認
   └─ 管理画面動作確認
   └─ 主要機能テスト

6. 記録
   └─ 更新履歴に記載
```

### 更新履歴の記録

| 記録項目 | 内容 |
|----------|------|
| 日時 | 更新実施日時 |
| 対象 | プラグイン名/テーマ名/WPバージョン |
| 変更前 | 旧バージョン |
| 変更後 | 新バージョン |
| 実施者 | 作業者名 |
| 備考 | 特記事項、問題発生時の内容 |

### ロールバック方針

| 状況 | 対応 |
|------|------|
| 軽微な表示崩れ | CSS調整で対応、ロールバック不要 |
| 機能停止 | 即時ロールバック |
| セキュリティ問題 | 代替策検討、ロールバックは最終手段 |

**ロールバック手順**:
1. 問題の切り分け（原因特定）
2. バックアップからの復元判断
3. 復元実行（該当ファイルのみ or 全体）
4. 動作確認
5. 原因調査・報告

---

## 3. 侵害検知

### 改ざん検知

| 監視対象 | 方法 | 頻度 |
|----------|------|------|
| コアファイル | ハッシュ比較 | 週1回 |
| テーマファイル | 更新日時監視 | 週1回 |
| プラグインファイル | 更新日時監視 | 週1回 |
| index.php | 手動確認 | 週1回 |
| .htaccess | 内容確認 | 週1回 |

### 検知時のアラート

| 検知内容 | アラート方法 | 通知先 |
|----------|--------------|--------|
| ファイル改ざん | メール即時 | 運用担当 + クライアント |
| 不正ログイン成功 | メール即時 | 運用担当 + クライアント |
| 不正ログイン試行（10回以上） | メール | 運用担当 |
| マルウェア検知 | メール即時 | 運用担当 + クライアント |

### 監視すべき兆候

- 見覚えのないユーザーアカウント
- 身に覚えのない投稿・ページ
- 不審なファイル（.php が uploads に存在等）
- .htaccess の不審な書き換え
- wp-config.php の変更
- 外部への不審なリダイレクト

---

## 4. ログ保全

### ログ種別と保管期間

| ログ種別 | 保管期間 | 保管場所 |
|----------|----------|----------|
| アクセスログ | 90日 | サーバー標準 |
| エラーログ | 90日 | サーバー標準 |
| WordPressログイン履歴 | 180日 | プラグイン or functions.php |
| 更新履歴 | 無期限 | 管理ドキュメント |
| インシデント記録 | 無期限 | 管理ドキュメント |

### ログ取得方法

| ログ | 取得方法 |
|------|----------|
| アクセスログ | サーバーパネル or FTP（/logs/） |
| エラーログ | サーバーパネル or FTP（/logs/） |
| WordPressログイン | 管理画面 or DB直接 |

### ログ確認項目

**週次確認**:
- 異常なアクセス元IP
- 404エラーの急増
- wp-login.php への集中アクセス
- xmlrpc.php へのアクセス
- POSTリクエストの異常

**月次確認**:
- アクセス傾向の変化
- エラー傾向の分析
- 不審なユーザーエージェント

---

## 5. サーバー/WAF/CDN設定

### WAF設定方針

| 設定項目 | 推奨設定 |
|----------|----------|
| WAF有効化 | ON |
| SQLインジェクション防御 | ON |
| XSS防御 | ON |
| ファイルインクルード防御 | ON |
| コマンドインジェクション防御 | ON |

### BOT対策

| 対策 | 方法 |
|------|------|
| 悪性BOTブロック | WAF / .htaccess |
| クローラー制御 | robots.txt |
| コメントスパムBOT | ハニーポット / JS検証 |
| ログインBOT | 試行回数制限 / reCAPTCHA |

### 国・地域ブロック（検討事項）

| 対象 | 判断基準 |
|------|----------|
| 全面ブロック | 対象国からの正規アクセスがない場合 |
| 管理画面のみブロック | 日本国内からのみ管理する場合 |
| ブロックしない | 海外ユーザーがいる場合 |

※ エックスサーバーの場合、海外IPアクセス制限機能あり

### CDN設定（Cloudflare等使用時）

| 設定項目 | 推奨 |
|----------|------|
| SSL/TLS | Full (Strict) |
| 自動HTTPS | ON |
| セキュリティレベル | Medium以上 |
| ブラウザ整合性チェック | ON |
| ホットリンク保護 | ON（画像直リンク防止） |

---

## 6. プラグインセキュリティ方針

### 脆弱性ウォッチ

| 情報源 | 確認頻度 |
|--------|----------|
| WPScan Vulnerability Database | 週1回 |
| WordPress公式セキュリティ情報 | 週1回 |
| プラグイン開発元のアナウンス | 更新時 |
| Wordfence脆弱性情報 | 週1回 |

### プラグイン選定基準

| 基準 | 内容 |
|------|------|
| 更新頻度 | 6ヶ月以内に更新あり |
| 有効インストール数 | 1万以上推奨 |
| 評価 | 4.0以上 |
| サポート対応 | フォーラムで回答あり |
| 互換性 | 現行WPバージョンと互換 |

### 脆弱性発見時の対応

| 深刻度 | 対応 |
|--------|------|
| Critical（CVSS 9.0-10.0） | 即時更新 or 無効化 |
| High（CVSS 7.0-8.9） | 24時間以内に更新 |
| Medium（CVSS 4.0-6.9） | 1週間以内に更新 |
| Low（CVSS 0.1-3.9） | 通常更新サイクルで対応 |

---

## 7. コア/テーマ更新方針

### WordPress本体

| 更新種別 | 対応方針 | 検証 |
|----------|----------|------|
| セキュリティリリース（x.x.1） | 48時間以内に適用 | 簡易確認 |
| マイナー更新（x.1.x） | 1週間以内に適用 | 標準検証 |
| メジャー更新（x.0.0） | 2週間様子見後に適用 | フル検証 |

### テーマ（SWELL）

| 更新種別 | 対応方針 |
|----------|----------|
| セキュリティ修正 | 即時適用 |
| 機能追加 | 1週間以内 |
| 大規模変更 | テスト環境で検証後 |

### 検証ルール

**簡易確認**:
- トップページ表示
- 主要ページ表示
- 管理画面ログイン

**標準検証**:
- 上記 + 投稿/編集機能
- コメント機能
- 問い合わせフォーム
- 会員機能（該当する場合）

**フル検証**:
- 上記 + 全ページ巡回
- 全プラグイン動作確認
- パフォーマンス確認
- モバイル表示確認

---

## 8. 重要ファイル保護

### ファイル別保護方針

| ファイル | 保護内容 |
|----------|----------|
| wp-config.php | 外部アクセス禁止、パーミッション 400 or 440 |
| .htaccess | パーミッション 644、定期的な内容確認 |
| xmlrpc.php | アクセス禁止（.htaccessで制御） |
| wp-login.php | IP制限 or 試行回数制限 |
| /wp-admin/ | IP制限推奨（運用に応じて） |
| /wp-includes/ | 直接アクセス禁止 |

### 推奨パーミッション

| 対象 | パーミッション |
|------|----------------|
| ディレクトリ | 755 |
| ファイル | 644 |
| wp-config.php | 400 or 440 |
| .htaccess | 644 |

### .htaccess 保護設定例

```apache
# wp-config.php 保護
<files wp-config.php>
order allow,deny
deny from all
</files>

# xmlrpc.php 無効化
<files xmlrpc.php>
order allow,deny
deny from all
</files>

# .htaccess 保護
<files .htaccess>
order allow,deny
deny from all
</files>

# wp-includes 直接アクセス禁止
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteRule ^wp-admin/includes/ - [F,L]
RewriteRule !^wp-includes/ - [S=3]
RewriteRule ^wp-includes/[^/]+\.php$ - [F,L]
RewriteRule ^wp-includes/js/tinymce/langs/.+\.php - [F,L]
RewriteRule ^wp-includes/theme-compat/ - [F,L]
</IfModule>
```

---

## 9. インシデント対応フロー

### フェーズ1: 検知・初動（0-2時間）

```
1. 異常検知
   └─ 監視アラート / ユーザー報告 / 定期確認

2. 初期評価
   └─ 影響範囲の確認
   └─ 緊急度の判定（Critical/High/Medium/Low）

3. 初動対応
   └─ 証拠保全（ログ、スクリーンショット）
   └─ 被害拡大防止（必要に応じてサイト停止）

4. 連絡
   └─ クライアントへ第一報
   └─ 状況と見通しを共有
```

### フェーズ2: 調査・対応（2-24時間）

```
1. 詳細調査
   └─ 侵入経路の特定
   └─ 被害範囲の特定
   └─ 漏洩データの有無確認

2. 対応策決定
   └─ 復旧方法の選択
   └─ 再発防止策の検討

3. 復旧作業
   └─ マルウェア除去 / ファイル復旧
   └─ パスワード変更
   └─ 脆弱性修正

4. 動作確認
   └─ 正常動作確認
   └─ セキュリティスキャン
```

### フェーズ3: 事後対応（24時間-1週間）

```
1. 報告書作成
   └─ 発生日時、検知経緯
   └─ 被害内容
   └─ 原因
   └─ 対応内容
   └─ 再発防止策

2. 再発防止
   └─ 恒久対策の実施
   └─ 監視強化

3. 振り返り
   └─ 対応の評価
   └─ 手順の改善
```

### 連絡テンプレート

**第一報（検知時）**:
```
【セキュリティインシデント発生のお知らせ】

発生日時: YYYY/MM/DD HH:MM
対象サイト:
事象:
現在の状況:
影響範囲: 調査中
対応状況:

次回報告予定: ○時間後
```

**中間報告**:
```
【セキュリティインシデント 中間報告】

原因:
被害範囲:
対応状況:
復旧見込み:

ご質問があればお知らせください。
```

**完了報告**:
```
【セキュリティインシデント 対応完了報告】

復旧日時:
原因:
実施した対策:
再発防止策:

詳細は別途報告書をお送りします。
```

---

## 改訂履歴

| 日付 | 内容 |
|------|------|
| 2026/01/11 | 初版作成 |
| 2026/01/11 | 保守プラン対応表を追加 |

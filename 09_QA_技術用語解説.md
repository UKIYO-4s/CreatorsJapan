# Q&A: 技術用語解説

プロジェクト進行中に発生した質問と回答のアーカイブ。

---

## Q1. REST API とは？

### 質問

REST APIとは何か？

### 回答

**「外部からWordPressのデータを操作できる窓口」**

#### 具体例

```
あなたのサイト: https://salon.creators-jp.com

REST APIの窓口:
https://salon.creators-jp.com/wp-json/wp/v2/

ここにアクセスすると...
/posts     → 記事一覧が取れる
/comments  → コメント一覧が取れる
/users     → ユーザー一覧が取れる
```

#### なぜ存在するか

| 用途 | 例 |
|------|-----|
| スマホアプリ | WordPress公式アプリがAPIで記事を取得・投稿 |
| 外部サービス連携 | Zapier、IFTTT等がWordPressと連携 |
| ヘッドレスCMS | フロントエンドをReact等で作り、データだけWordPressから取得 |
| Gutenberg | ブロックエディタ自体がREST APIを使用 |

#### 今回の問題点

**認証なしでコメント投稿できる場合がある**

```
スパムボットの動き:
1. https://salon.creators-jp.com/wp-json/wp/v2/comments を発見
2. POST リクエストでコメントを送信
3. 会員制の壁を突破してスパム投稿成功
```

---

## Q2. functions.php とは？

### 質問

functions.phpは何をしているのか？

### 回答

**「テーマの動作をカスタマイズするための設定ファイル」**

#### 場所

```
/wp-content/themes/swell-child/functions.php
（または /wp-content/themes/swell/functions.php）
```

#### 役割

| できること | 例 |
|-----------|-----|
| 機能の追加 | 独自のショートコード追加 |
| 機能の変更 | デフォルト動作のカスタマイズ |
| **機能の制限** | REST APIの無効化 ← 今回これ |
| 外観の調整 | ロゴサイズ変更、フォント変更 |

#### プラグインとの違い

| | functions.php | プラグイン |
|---|---------------|-----------|
| 場所 | テーマ内 | /wp-content/plugins/ |
| テーマ変更時 | **消える**（子テーマなら残る） | 残る |
| 管理 | FTPで直接編集 | 管理画面で有効/無効 |
| 推奨用途 | テーマ固有のカスタマイズ | 汎用的な機能追加 |

#### 今回の使い方

```php
// functions.php に追加するコード
add_filter('rest_pre_insert_comment', function($prepared_comment, $request) {
    // REST API経由のコメント投稿を拒否
    return new WP_Error('rest_comment_disabled', 'コメント投稿は無効です', array('status' => 403));
}, 10, 2);
```

**これを追加すると**: REST API経由でコメント投稿しようとすると「403 Forbidden」が返る

---

## Q3. 外部アプリ連携・プラグイン競合はこちらで確認できるか？

### 質問

外部アプリ連携の停止やプラグインとの競合について、クライアントが100％把握していない可能性がある。こちらから確認できるか？

### 回答

**結論：大部分はこちらで確認可能**

#### A. REST APIを使っているプラグインの確認

```bash
# サイトのREST APIエンドポイント一覧を取得
curl https://salon.creators-jp.com/wp-json/

# これで登録されているAPI一覧が見える
# → 見慣れないエンドポイントがあれば、それを使うプラグインがある
```

#### B. 有効なプラグイン一覧の確認（管理画面で）

```
管理画面 → プラグイン → インストール済みプラグイン

確認すべきプラグイン:
- Jetpack（REST API/XMLRPC使用）
- WooCommerce（REST API使用）
- Contact Form 7（REST API使用の場合あり）
- 連携系プラグイン（Zapier, Mailchimp等）
```

#### C. XMLRPC使用状況の確認

```bash
# XMLRPC が有効かどうか
curl -X POST https://salon.creators-jp.com/xmlrpc.php \
  -H "Content-Type: text/xml" \
  -d '<?xml version="1.0"?><methodCall><methodName>system.listMethods</methodName></methodCall>'

# 有効な場合: メソッド一覧が返る
# 無効な場合: エラーまたは403
```

#### D. 確認可能な項目リスト

| 確認項目 | 確認方法 | 必要な権限 |
|----------|----------|-----------|
| 有効プラグイン一覧 | 管理画面 | 管理者 |
| REST APIエンドポイント | curl/ブラウザ | なし（公開情報） |
| XMLRPC有効/無効 | curl | なし |
| 外部サービス連携 | プラグイン設定画面 | 管理者 |
| Jetpack連携状況 | Jetpack設定画面 | 管理者 |

#### クライアントに確認が必要な項目

**技術的に確認できないもの**:

| 項目 | 理由 |
|------|------|
| スマホアプリ使用の有無 | クライアントの習慣の問題 |
| 外部ツールからの投稿 | Windows Live Writer等の使用有無 |
| 今後の使用予定 | 将来の計画はクライアントしか分からない |

#### 確認作業の分担まとめ

| 確認項目 | 誰が確認 |
|----------|----------|
| 有効プラグイン一覧 | **こちら**（管理画面アクセス後） |
| REST API状態 | **こちら**（curlで確認可能） |
| XMLRPC状態 | **こちら**（curlで確認可能） |
| スマホアプリ使用 | **クライアント** |
| 外部ツール使用 | **クライアント** |

---

## Q4. HTTPステータスコード（200 OK / 403 Forbidden）とは？

### 質問

200 OK、403 Forbiddenを理解したい。

### 回答

#### 200 OK

```
意味: 「リクエスト成功しました」

例:
あなた → サーバー: 「このページを見せて」
サーバー → あなた: 「200 OK、はいどうぞ」（ページ表示）
```

#### 403 Forbidden

```
意味: 「アクセス禁止です」

例:
スパムボット → サーバー: 「コメント投稿させて」
サーバー → ボット: 「403 Forbidden、お前はダメだ」（拒否）
```

#### よく見るステータスコード一覧

| コード | 意味 | 例 |
|--------|------|-----|
| **200** | 成功 | 正常にページ表示 |
| **301** | 永久移動 | URLが変わった（リダイレクト） |
| **302** | 一時移動 | 一時的なリダイレクト |
| **400** | 不正リクエスト | 送ったデータがおかしい |
| **401** | 認証必要 | ログインしてください |
| **403** | **禁止** | アクセス権限がない |
| **404** | 見つからない | ページが存在しない |
| **500** | サーバーエラー | サーバー側で問題発生 |
| **503** | サービス停止 | メンテナンス中等 |

#### 今回の文脈での使い方

```
【REST API制限の確認】

制限前:
curl → 200 OK（コメント投稿成功）
→ スパムが通る

制限後:
curl → 403 Forbidden（拒否）
→ スパムがブロックされる
```

---

## 用語まとめ

| 用語 | 一言説明 |
|------|----------|
| REST API | WordPressを外部から操作できる窓口 |
| functions.php | テーマの動作をカスタマイズする設定ファイル |
| 200 OK | リクエスト成功 |
| 403 Forbidden | アクセス拒否 |
| XMLRPC | 古い外部連携の仕組み（スマホアプリ等で使用） |
| curl | コマンドラインからHTTPリクエストを送るツール |

---

## 改訂履歴

| 日付 | 内容 |
|------|------|
| 2026/01/11 | 初版作成（Q1-Q4） |

# Q&A: 技術用語解説

プロジェクト進行中に発生した質問と回答のアーカイブ。

---

## Q1. REST API とは？

### 質問

REST APIとは何か？

### 回答

**「外部からWordPressのデータを操作できる窓口」**

#### 具体例

```
あなたのサイト: https://salon.creators-jp.com

REST APIの窓口:
https://salon.creators-jp.com/wp-json/wp/v2/

ここにアクセスすると...
/posts     → 記事一覧が取れる
/comments  → コメント一覧が取れる
/users     → ユーザー一覧が取れる
```

#### なぜ存在するか

| 用途 | 例 |
|------|-----|
| スマホアプリ | WordPress公式アプリがAPIで記事を取得・投稿 |
| 外部サービス連携 | Zapier、IFTTT等がWordPressと連携 |
| ヘッドレスCMS | フロントエンドをReact等で作り、データだけWordPressから取得 |
| Gutenberg | ブロックエディタ自体がREST APIを使用 |

#### 今回の問題点

**認証なしでコメント投稿できる場合がある**

```
スパムボットの動き:
1. https://salon.creators-jp.com/wp-json/wp/v2/comments を発見
2. POST リクエストでコメントを送信
3. 会員制の壁を突破してスパム投稿成功
```

---

## Q2. functions.php とは？

### 質問

functions.phpは何をしているのか？

### 回答

**「テーマの動作をカスタマイズするための設定ファイル」**

#### 場所

```
/wp-content/themes/swell-child/functions.php
（または /wp-content/themes/swell/functions.php）
```

#### 役割

| できること | 例 |
|-----------|-----|
| 機能の追加 | 独自のショートコード追加 |
| 機能の変更 | デフォルト動作のカスタマイズ |
| **機能の制限** | REST APIの無効化 ← 今回これ |
| 外観の調整 | ロゴサイズ変更、フォント変更 |

#### プラグインとの違い

| | functions.php | プラグイン |
|---|---------------|-----------|
| 場所 | テーマ内 | /wp-content/plugins/ |
| テーマ変更時 | **消える**（子テーマなら残る） | 残る |
| 管理 | FTPで直接編集 | 管理画面で有効/無効 |
| 推奨用途 | テーマ固有のカスタマイズ | 汎用的な機能追加 |

#### 今回の使い方

```php
// functions.php に追加するコード
add_filter('rest_pre_insert_comment', function($prepared_comment, $request) {
    // REST API経由のコメント投稿を拒否
    return new WP_Error('rest_comment_disabled', 'コメント投稿は無効です', array('status' => 403));
}, 10, 2);
```

**これを追加すると**: REST API経由でコメント投稿しようとすると「403 Forbidden」が返る

---

## Q3. 外部アプリ連携・プラグイン競合はこちらで確認できるか？

### 質問

外部アプリ連携の停止やプラグインとの競合について、クライアントが100％把握していない可能性がある。こちらから確認できるか？

### 回答

**結論：大部分はこちらで確認可能**

#### A. REST APIを使っているプラグインの確認

```bash
# サイトのREST APIエンドポイント一覧を取得
curl https://salon.creators-jp.com/wp-json/

# これで登録されているAPI一覧が見える
# → 見慣れないエンドポイントがあれば、それを使うプラグインがある
```

#### B. 有効なプラグイン一覧の確認（管理画面で）

```
管理画面 → プラグイン → インストール済みプラグイン

確認すべきプラグイン:
- Jetpack（REST API/XMLRPC使用）
- WooCommerce（REST API使用）
- Contact Form 7（REST API使用の場合あり）
- 連携系プラグイン（Zapier, Mailchimp等）
```

#### C. XMLRPC使用状況の確認

```bash
# XMLRPC が有効かどうか
curl -X POST https://salon.creators-jp.com/xmlrpc.php \
  -H "Content-Type: text/xml" \
  -d '<?xml version="1.0"?><methodCall><methodName>system.listMethods</methodName></methodCall>'

# 有効な場合: メソッド一覧が返る
# 無効な場合: エラーまたは403
```

#### D. 確認可能な項目リスト

| 確認項目 | 確認方法 | 必要な権限 |
|----------|----------|-----------|
| 有効プラグイン一覧 | 管理画面 | 管理者 |
| REST APIエンドポイント | curl/ブラウザ | なし（公開情報） |
| XMLRPC有効/無効 | curl | なし |
| 外部サービス連携 | プラグイン設定画面 | 管理者 |
| Jetpack連携状況 | Jetpack設定画面 | 管理者 |

#### クライアントに確認が必要な項目

**技術的に確認できないもの**:

| 項目 | 理由 |
|------|------|
| スマホアプリ使用の有無 | クライアントの習慣の問題 |
| 外部ツールからの投稿 | Windows Live Writer等の使用有無 |
| 今後の使用予定 | 将来の計画はクライアントしか分からない |

#### 確認作業の分担まとめ

| 確認項目 | 誰が確認 |
|----------|----------|
| 有効プラグイン一覧 | **こちら**（管理画面アクセス後） |
| REST API状態 | **こちら**（curlで確認可能） |
| XMLRPC状態 | **こちら**（curlで確認可能） |
| スマホアプリ使用 | **クライアント** |
| 外部ツール使用 | **クライアント** |

---

## Q4. HTTPステータスコード（200 OK / 403 Forbidden）とは？

### 質問

200 OK、403 Forbiddenを理解したい。

### 回答

#### 200 OK

```
意味: 「リクエスト成功しました」

例:
あなた → サーバー: 「このページを見せて」
サーバー → あなた: 「200 OK、はいどうぞ」（ページ表示）
```

#### 403 Forbidden

```
意味: 「アクセス禁止です」

例:
スパムボット → サーバー: 「コメント投稿させて」
サーバー → ボット: 「403 Forbidden、お前はダメだ」（拒否）
```

#### よく見るステータスコード一覧

| コード | 意味 | 例 |
|--------|------|-----|
| **200** | 成功 | 正常にページ表示 |
| **301** | 永久移動 | URLが変わった（リダイレクト） |
| **302** | 一時移動 | 一時的なリダイレクト |
| **400** | 不正リクエスト | 送ったデータがおかしい |
| **401** | 認証必要 | ログインしてください |
| **403** | **禁止** | アクセス権限がない |
| **404** | 見つからない | ページが存在しない |
| **500** | サーバーエラー | サーバー側で問題発生 |
| **503** | サービス停止 | メンテナンス中等 |

#### 今回の文脈での使い方

```
【REST API制限の確認】

制限前:
curl → 200 OK（コメント投稿成功）
→ スパムが通る

制限後:
curl → 403 Forbidden（拒否）
→ スパムがブロックされる
```

---

## 用語まとめ

| 用語 | 一言説明 |
|------|----------|
| REST API | WordPressを外部から操作できる窓口 |
| functions.php | テーマの動作をカスタマイズする設定ファイル |
| 200 OK | リクエスト成功 |
| 403 Forbidden | アクセス拒否 |
| XMLRPC | 古い外部連携の仕組み（スマホアプリ等で使用） |
| curl | コマンドラインからHTTPリクエストを送るツール |

---

## Q5. xmlrpc.php とは？

### 質問

xmlrpc.phpとは何か？

### 回答

**「WordPressを外部から操作するための古い仕組み」**

```
歴史:
2000年代: REST APIがない時代、外部連携はこれしかなかった
2015年〜: REST APIが登場、xmlrpcは徐々に不要に
現在: ほぼレガシー（古い遺産）、セキュリティリスクの方が大きい
```

| 用途 | 説明 |
|------|------|
| スマホアプリ | WordPress公式アプリの旧方式 |
| 外部投稿ツール | Windows Live Writer等 |
| pingback | 他サイトからのリンク通知（今は使われない） |

**問題点**: ブルートフォース攻撃（パスワード総当たり）の標的になりやすい

---

## Q6. .htaccess とは？

### 質問

.htaccessとは何か？よく見るけど知らない。

### 回答

**「Apacheサーバーの設定ファイル」**

```
場所: WordPressルートディレクトリ（/public_html/.htaccess 等）
役割: そのディレクトリ以下の動作を制御
```

| できること | 例 |
|-----------|-----|
| リダイレクト | http → https への転送 |
| アクセス制限 | 特定ファイルへのアクセス禁止 |
| 認証 | Basic認証（パスワード保護） |
| URLの書き換え | パーマリンク設定 |
| キャッシュ制御 | ブラウザキャッシュの設定 |

**WordPressでの使われ方**:
```apache
# WordPressデフォルトの.htaccess
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
```
↑ これが「パーマリンク」を動かしている

---

## Q7. Jetpack とは？

### 質問

Jetpackとは何か？一応知っておきたい。

### 回答

**「WordPress.com公式の多機能プラグイン」**

```
開発元: Automattic（WordPress.comの運営会社）
特徴: 1つのプラグインに大量の機能を詰め込んでいる
```

| 機能 | 説明 |
|------|------|
| セキュリティ | ブルートフォース対策、ダウンタイム監視 |
| バックアップ | 自動バックアップ（有料） |
| 高速化 | CDN、画像最適化 |
| SNS連携 | 自動投稿 |
| 統計 | アクセス解析 |

**XMLRPC無効化との関係**:
- JetpackはXMLRPCを使ってWordPress.comと通信する
- XMLRPC無効化 → **Jetpackの一部機能が停止**
- 今回のサイトでJetpackが有効かどうか要確認

---

## Q8. 不要なテーマ一覧

### 質問

不要なテーマがあれば教えてほしい。

### 回答

creators-jp.comの場合（推定）:

| テーマ | 判断 | 理由 |
|--------|------|------|
| **SWELL** | **残す** | 現在有効なテーマ |
| **SWELL CHILD** | **残す** | 子テーマ（カスタマイズ用） |
| **Twenty Twenty-Four** | **残す** | 緊急時の切り替え用（1つは残す） |
| Twenty Twenty-Three | 削除可 | 不要 |
| Twenty Twenty-Two | 削除可 | 不要 |
| Twenty Twenty-One | 削除可 | 不要 |
| Twenty Twenty | 削除可 | 不要 |
| Twenty Nineteen | 削除可 | 不要 |
| Twenty Seventeen | 削除可 | 不要 |
| PORIPU | 削除可 | 前テーマ（SWELLに移行済み） |
| その他 | 削除可 | 使用していない |

**確認方法**: 管理画面 → 外観 → テーマ で一覧を見て、「有効」以外を削除

**残すべきテーマのルール**:
1. 現在有効なテーマ
2. 子テーマ（親テーマに依存）
3. デフォルトテーマ1つ（緊急時用）

---

## Q9. 更新時のデバッグ・差分確認

### 質問

バックアップ取得は良い。デバッグリストを詳細に作るべき。構造を事前にDOM解析しておき、差分を確認するなど。

### 回答

ご提案の通り、事前にDOM解析して差分確認するのは有効。

**実装案**:

```bash
# 更新前にページのHTMLを保存
curl https://creators-jp.com > before.html
curl https://creators-jp.com/about > before_about.html

# 更新後に再取得
curl https://creators-jp.com > after.html

# 差分確認
diff before.html after.html
```

**詳細チェックリスト**:

| 確認項目 | 方法 | 合格基準 |
|----------|------|----------|
| トップページ表示 | 目視 | 崩れなし |
| 主要ページ表示 | 目視 | 崩れなし |
| **DOM構造** | 開発者ツール | 重要要素が存在 |
| **CSSの適用** | 開発者ツール | スタイル崩れなし |
| **JSエラー** | コンソール | エラーなし |
| リンク動作 | クリック | 404なし |
| フォーム動作 | 送信テスト | 送信成功 |
| モバイル表示 | レスポンシブ確認 | 崩れなし |

→ #4（リスク対策と手順書）で詳細化予定

---

## Q10. セキュリティヘッダーの重要性

### 質問

セキュリティヘッダーの重要性がよくわからない。

### 回答

**結論: 「保険」のようなもの。あると安心、なくても即座に被害は出ない**

| ヘッダー | 防ぐ攻撃 | 重要度 | 説明 |
|----------|----------|--------|------|
| X-XSS-Protection | XSS攻撃 | 中 | ブラウザの保護機能を有効化 |
| X-Content-Type-Options | MIMEスニッフィング | 低 | ファイル種別の誤認を防ぐ |
| X-Frame-Options | クリックジャッキング | **高** | 他サイトへのiframe埋め込みを防ぐ |
| Referrer-Policy | 情報漏洩 | 低 | リファラー情報の送信を制限 |

**X-Frame-Options が最も重要な理由**:

```
攻撃例（クリックジャッキング）:
1. 悪意あるサイトがあなたのサイトをiframeで埋め込む
2. その上に透明なボタンを重ねる
3. ユーザーは気づかずにクリック
4. 意図しない操作（購入、いいね等）が実行される

X-Frame-Options: SAMEORIGIN を設定すると:
→ 他サイトからのiframe埋め込みが禁止される
→ 攻撃が成立しない
```

**優先度の判断**:
- 今回のスパム問題とは直接関係なし
- ただし、セキュリティ対策として「やっておいて損はない」
- 設定は簡単（.htaccessに数行追加するだけ）

---

## Q11. wp-config.php とは？

### 質問

wp-config.phpは何をしている？

### 回答

**「WordPressの最重要設定ファイル」**

```
場所: WordPressルートディレクトリ（/public_html/wp-config.php 等）
```

| 含まれる情報 | 内容 | 漏洩時のリスク |
|-------------|------|---------------|
| **DB接続情報** | ホスト名、ユーザー名、パスワード | データベース完全アクセス |
| **認証キー** | セッション暗号化キー | なりすましログイン |
| **テーブル接頭辞** | wp_ 等 | SQLインジェクション容易化 |
| デバッグ設定 | WP_DEBUG | エラー情報漏洩 |

**実際のファイル内容（例）**:
```php
// データベース設定（これが漏れると致命的）
define('DB_NAME', 'wordpress_db');
define('DB_USER', 'db_user');
define('DB_PASSWORD', 'super_secret_password');  // ← これ
define('DB_HOST', 'localhost');

// 認証キー（これも漏れると危険）
define('AUTH_KEY', 'ランダムな長い文字列');
define('SECURE_AUTH_KEY', 'ランダムな長い文字列');
```

**なぜ保護が必要か**:
```
漏洩シナリオ:
1. wp-config.php に直接アクセスされる
2. DB接続情報が見える
3. 攻撃者がDBに直接接続
4. 全データ（ユーザー情報、記事、設定）が盗まれる
5. 管理者パスワードを書き換えられる
6. サイト完全制御

保護後:
1. wp-config.php に直接アクセス → 403 Forbidden
2. 攻撃失敗
```

---

## Q12. パーミッションとは？

### 質問

パーミッション（Permission）とは？

### 回答

**「ファイルへのアクセス権限」**

サーバー上のファイルに「誰が何をできるか」を設定する仕組み。

| 数字 | 意味 | できること |
|------|------|-----------|
| 7 | 読み書き実行 | すべてOK |
| 6 | 読み書き | 見る・編集できる |
| 4 | 読み取りのみ | 見るだけ |
| 0 | なし | 何もできない |

**3桁の読み方**:

```
644 の場合:
├─ 6: 所有者 → 読み書きOK
├─ 4: グループ → 読むだけ
└─ 4: その他 → 読むだけ
```

**WordPress推奨パーミッション**:

| 対象 | パーミッション | 理由 |
|------|----------------|------|
| ディレクトリ | 755 | 所有者は全操作可、他は閲覧・実行のみ |
| 通常ファイル | 644 | 所有者は読み書き、他は読み取りのみ |
| wp-config.php | 400 or 440 | 所有者のみ読み取り（最重要ファイル） |

**設定方法**: FTPソフトまたはサーバーパネルで変更可能

---

## Q13. インシデントとは？

### 質問

インシデント（Incident）とは？

### 回答

**「セキュリティ上の問題が発生した事態」**

| 重大度 | 例 | 対応 |
|--------|-----|------|
| Critical | サイト改ざん、情報漏洩 | 即時対応、サイト停止検討 |
| High | 不正ログイン成功、マルウェア感染 | 数時間以内に対応 |
| Medium | 大量のログイン試行、脆弱性発見 | 24時間以内に対応 |
| Low | スパムコメント、軽微な異常 | 通常対応 |

**今回のスパム投稿の位置付け**:
- 重大度: **Low〜Medium**
- 理由: 直接的な被害（情報漏洩等）はないが、セキュリティホールの存在を示唆

**インシデント対応の流れ**:
```
1. 検知 → 異常を発見
2. 初動 → 被害拡大防止、証拠保全
3. 調査 → 原因特定
4. 復旧 → 修正・クリーンアップ
5. 報告 → 報告書作成
6. 再発防止 → 恒久対策
```

---

## 改訂履歴

| 日付 | 内容 |
|------|------|
| 2026/01/11 | 初版作成（Q1-Q4） |
| 2026/01/11 | Q5-Q11追加（xmlrpc, .htaccess, Jetpack, テーマ, デバッグ, セキュリティヘッダー, wp-config） |
| 2026/01/11 | Q12-Q13追加（パーミッション, インシデント） |
